---
import { getRelativeLocaleUrl } from 'astro:i18n';
import { getLangFromUrl, useTranslations } from '../i18n/utils';
// Asegurar que i18next está inicializado y obtener el idioma actual
const currentLanguage = getLangFromUrl(new URL(Astro.url.href));
const t = useTranslations(currentLanguage);
--- 

<div class="flex flex-col mx-auto px-4 max-w-7xl gap-6 sm:gap-8 items-center mb-12 sm:mb-20">
  <!-- Título principal -->
  <h2 class="text-3xl sm:text-4xl mt-6 sm:mt-8 font-bold text-secondary relative">
    <span class="relative z-10">{t('curriculum.title')}</span>
    <span class="absolute bottom-2 left-0 w-full h-3 bg-special opacity-30 -z-0"></span>
  </h2>
  
  <!-- Banner principal con información y botón de descarga -->
  <div class="w-full bg-gradient-to-r from-secondary to-secondary/90 rounded-lg shadow-lg overflow-hidden">
    <div class="flex flex-col md:flex-row items-center">
      <div class="flex flex-col p-5 sm:p-6 md:p-8 gap-4 sm:gap-6 md:w-2/3">
        <p class="text-base sm:text-lg md:text-xl leading-relaxed text-white">{t('curriculum.intro1')}</p>
        <p class="text-base sm:text-lg md:text-xl leading-relaxed text-white">{t('curriculum.intro2')}</p>
        <a target="_blank" href="/Curriculum-JoelMesas.pdf" class="self-start">
          <button class="bg-special hover:bg-special/90 text-secondary font-bold rounded-xl py-2 sm:py-3 px-4 sm:px-6 cursor-pointer transition-all duration-300 shadow-md hover:shadow-lg flex items-center gap-2">
            {t('curriculum.downloadCV')} <i class="fa-solid fa-download ml-2"></i>
          </button>
        </a>
      </div>
      <div class="md:w-1/3 p-5 sm:p-6 flex justify-center items-center">
        <img class="w-32 h-32 sm:w-48 sm:h-48 md:w-64 md:h-64 object-cover rounded-full border-4 border-special shadow-lg" src="/ordenadorImg.jpg" alt="Imagen de perfil o desarrollo web">
      </div>
    </div>
  </div>
  
  <!-- Título para los apartados -->
  <h2 class="text-2xl sm:text-3xl mt-6 sm:mt-8 font-bold text-secondary relative self-center">
    <span class="relative z-10">{t('curriculum.title2')}</span>
    <span class="absolute bottom-2 left-0 w-full h-3 bg-special opacity-30 -z-0"></span>
  </h2>
  
  <!-- Carrusel con navegación integrada -->
  <div class="w-full max-w-6xl">
    <!-- Controles e indicadores -->
    <div class="flex justify-between items-center mb-4 sm:mb-6">
      <button id="prevBtn" class="bg-primary hover:bg-primary-light text-white font-bold py-2 sm:py-3 px-3 sm:px-5 rounded-full transition-all duration-300 shadow-md flex items-center gap-1 sm:gap-2 text-sm sm:text-base">
        <i class="fa-solid fa-arrow-left"></i> <span class="hidden xs:inline">{t('curriculum.button.previous')}</span>
      </button>
      
      <div class="flex gap-2 sm:gap-3 overflow-x-auto px-1 py-2 justify-center">
        <button class="dot-btn flex flex-col items-center min-w-max">
          <span class="dot cursor-pointer w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-primary scale-110 transition-all duration-300"></span>
          <span class="text-xxs sm:text-xs mt-1 text-secondary font-medium whitespace-nowrap">{t('curriculum.softSkills')}</span>
        </button>
        <button class="dot-btn flex flex-col items-center min-w-max">
          <span class="dot cursor-pointer w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-gray-400 transition-all duration-300"></span>
          <span class="text-xxs sm:text-xs mt-1 text-secondary font-medium whitespace-nowrap">{t('curriculum.technologies')}</span>
        </button>
        <button class="dot-btn flex flex-col items-center min-w-max">
          <span class="dot cursor-pointer w-3 h-3 sm:w-4 sm:h-4 rounded-full bg-gray-400 transition-all duration-300"></span>
          <span class="text-xxs sm:text-xs mt-1 text-secondary font-medium whitespace-nowrap">{t('curriculum.languages')}</span>
        </button>
      </div>
      
      <button id="nextBtn" class="bg-primary hover:bg-primary-light text-white font-bold py-2 sm:py-3 px-3 sm:px-5 rounded-full transition-all duration-300 shadow-md flex items-center gap-1 sm:gap-2 text-sm sm:text-base">
        <span class="hidden xs:inline">{t('curriculum.button.next')}</span> <i class="fa-solid fa-arrow-right"></i>
      </button>
    </div>
    
    <!-- Contenedor del carrusel -->
    <div class="carousel-container relative w-full overflow-hidden rounded-xl shadow-xl border border-gray-200 h-auto min-h-[280px] sm:min-h-[320px] mb-8 sm:mb-12">
      <div id="carousel" class="carousel-inner flex h-full transition-transform duration-500 ease-in-out">
        
        <!-- Diapositiva Soft Skills -->
        <section class="carousel-slide w-full min-w-full flex flex-col justify-start items-center bg-gradient-to-r from-primary to-primary-light p-4 sm:p-6 overflow-y-auto min-h-[280px] sm:min-h-[320px]">
          <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold my-3 sm:my-4 text-white drop-shadow-md sticky top-0 bg-primary/80 w-full text-center py-2 z-10">{t('curriculum.softSkills')}</h2>
          <div class="grid grid-cols-1 xs:grid-cols-2 md:grid-cols-3 gap-2 sm:gap-4 slide-content opacity-0 w-full max-w-4xl px-2 sm:px-0 pb-3">
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-special">
              <div class="text-sm sm:text-base font-semibold">{t('softSkills.teamwork')}</div>
              <div class="text-amber-500 mt-1">⭐⭐⭐⭐⭐</div>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-special">
              <div class="text-sm sm:text-base font-semibold">{t('softSkills.organisation')}</div>
              <div class="text-amber-500 mt-1">⭐⭐⭐⭐</div>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-special">
              <div class="text-sm sm:text-base font-semibold">{t('softSkills.responsibility')}</div>
              <div class="text-amber-500 mt-1">⭐⭐⭐⭐⭐</div>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-special">
              <div class="text-sm sm:text-base font-semibold">{t('softSkills.creativity')}</div>
              <div class="text-amber-500 mt-1">⭐⭐⭐⭐</div>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-special">
              <div class="text-sm sm:text-base font-semibold">{t('softSkills.flexibility')}</div>
              <div class="text-amber-500 mt-1">⭐⭐⭐⭐⭐</div>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-special">
              <div class="text-sm sm:text-base font-semibold">{t('softSkills.empathy')}</div>
              <div class="text-amber-500 mt-1">⭐⭐⭐⭐⭐</div>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-special">
              <div class="text-sm sm:text-base font-semibold">{t('softSkills.troubleshooting')}</div>
              <div class="text-amber-500 mt-1">⭐⭐⭐⭐⭐</div>
            </div>
          </div>
        </section>
        
        <!-- Diapositiva Tecnologías -->
        <section class="carousel-slide w-full min-w-full flex flex-col justify-start items-center bg-gradient-to-r from-secondary to-secondary/80 p-4 sm:p-6 overflow-y-auto min-h-[280px] sm:min-h-[320px]">
          <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold my-3 sm:my-4 text-white drop-shadow-md sticky top-0 bg-secondary/80 w-full text-center py-2 z-10">{t('curriculum.technologies')}</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-4 slide-content opacity-0 w-full max-w-4xl px-2 sm:px-0 pb-3">
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/javascript.jpg" alt="Logo Javascript">
              <span class="text-xs sm:text-sm md:text-base font-medium">JavaScript</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/laravel.png" alt="Logo Laravel">
              <span class="text-xs sm:text-sm md:text-base font-medium">Laravel</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/react.png" alt="Logo React">
              <span class="text-xs sm:text-sm md:text-base font-medium">React</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/php.png" alt="Logo PHP">
              <span class="text-xs sm:text-sm md:text-base font-medium">PHP</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/typescript.png" alt="Logo TypeScript">
              <span class="text-xs sm:text-sm md:text-base font-medium">TypeScript</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/angular.png" alt="Logo Angular">
              <span class="text-xs sm:text-sm md:text-base font-medium">Angular</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/symfony.png" alt="Logo Symfony">
              <span class="text-xs sm:text-sm md:text-base font-medium">Symfony</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/mysql.png" alt="Logo MySQL">
              <span class="text-xs sm:text-sm md:text-base font-medium">MySQL</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/astro.png" alt="Logo Astro">
              <span class="text-xs sm:text-sm md:text-base font-medium">Astro</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/bootstrap.png" alt="Logo Bootstrap">
              <span class="text-xs sm:text-sm md:text-base font-medium">Bootstrap</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-all duration-300 hover:bg-white hover:shadow-lg flex items-center gap-2 sm:gap-3 group">
              <img class="w-6 h-6 sm:w-8 sm:h-8 object-contain group-hover:scale-110 transition-transform" src="/src/assets/tailwind.png" alt="Logo Tailwind">
              <span class="text-xs sm:text-sm md:text-base font-medium">Tailwind</span>
            </div>
          </div>
        </section>
        
        <!-- Diapositiva Idiomas -->
        <section class="carousel-slide w-full min-w-full flex flex-col justify-start items-center bg-gradient-to-r from-special to-special/80 p-4 sm:p-6 overflow-y-auto min-h-[280px] sm:min-h-[320px]">
          <h2 class="text-2xl sm:text-3xl md:text-4xl font-bold my-3 sm:my-4 text-white drop-shadow-sm sticky top-0 bg-special/80 w-full text-center py-2 z-10">{t('curriculum.languages')}</h2>
          <div class="grid grid-cols-1 gap-3 sm:gap-4 slide-content opacity-0 w-full max-w-4xl px-2 sm:px-0 pb-3">
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-secondary flex items-center gap-3">
              <img class="w-6 h-5 sm:w-8 sm:h-6 object-contain" src="/español.png" alt="Español">
              <span class="text-sm sm:text-base font-medium">{t('languages.spanish')}</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-secondary flex items-center gap-3">
              <img class="w-6 h-5 sm:w-8 sm:h-6 object-contain" src="/catalan.png" alt="Catalán">
              <span class="text-sm sm:text-base font-medium">{t('languages.catalan')}</span>
            </div>
            <div class="bg-white/95 p-3 sm:p-4 rounded-lg shadow-md hover:scale-105 transition-transform duration-300 hover:bg-white border-l-4 border-secondary flex items-center gap-3">
              <img class="w-6 h-5 sm:w-8 sm:h-6 object-contain" src="/ingles.jfif" alt="Inglés">
              <span class="text-sm sm:text-base font-medium">{t('languages.english')}</span>
            </div>
          </div>
        </section>
        
      </div>
    </div>
    
    <!-- Separador decorativo -->
    <div class="w-full flex justify-center items-center my-6 sm:my-8">
      <div class="h-1 bg-gradient-to-r from-transparent via-special to-transparent w-3/4"></div>
    </div>
    
    <!-- Mensaje de cierre -->
    <div class="text-center mb-8 sm:mb-12 max-w-2xl mx-auto">
      <p class="text-base sm:text-lg text-secondary"> {t('curriculum.info')}</p>
    </div>
</div>

<!-- Estilos para animaciones -->
<style>
  @keyframes fadeInUp {
    from { 
      opacity: 0; 
      transform: translateY(20px); 
    }
    to { 
      opacity: 1; 
      transform: translateY(0); 
    }
  }
  
  .slide-content.active {
    opacity: 1;
  }
  
  /* Para que el scroll sea más suave en las diapositivas */
  .carousel-slide {
    scrollbar-width: thin;
    scrollbar-color: rgba(155, 155, 155, 0.5) transparent;
  }
  
  .carousel-slide::-webkit-scrollbar {
    width: 6px;
  }
  
  .carousel-slide::-webkit-scrollbar-track {
    background: transparent;
  }
  
  .carousel-slide::-webkit-scrollbar-thumb {
    background-color: rgba(155, 155, 155, 0.5);
    border-radius: 20px;
  }
  
  /* Añadir clase custom para pantallas extra pequeñas */
  @media (min-width: 475px) {
    .xs\:inline {
      display: inline;
    }
    .xs\:grid-cols-2 {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }
    .xs\:col-span-2 {
      grid-column: span 2 / span 2;
    }
    .xs\:max-w-xs {
      max-width: 20rem;
    }
    .xs\:mx-auto {
      margin-left: auto;
      margin-right: auto;
    }
  }
  
  /* Tamaño de texto extra pequeño para móviles */
  .text-xxs {
    font-size: 0.65rem;
  }

  /* Prevenir texto demasiado largo sin espacios que rompa el diseño */
  .whitespace-nowrap {
    white-space: nowrap;
  }
  .min-w-max {
    min-width: max-content;
  }
</style>

<!-- Script para el carrusel -->
<script is:inline>
  function inicializarCarrusel() {
    const carousel = document.getElementById('carousel');
    const slides = document.querySelectorAll('.carousel-slide');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const contents = document.querySelectorAll('.slide-content');
    
    if (!carousel || slides.length === 0) return;
    
    let currentIndex = 0;
    const totalSlides = slides.length;
    
    function updateCarousel() {
      carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
      
      // Actualiza los indicadores (dot-btns)
      const dotButtons = document.querySelectorAll('.dot-btn .dot');
      dotButtons.forEach((dot, index) => {
        if (index === currentIndex) {
          dot.classList.add('scale-110', 'bg-primary');
          dot.classList.remove('bg-gray-400');
        } else {
          dot.classList.remove('scale-110', 'bg-primary');
          dot.classList.add('bg-gray-400');
        }
      });
      
      // Oculta todos los contenidos
      contents.forEach(content => {
        content.classList.remove('active');
        content.style.opacity = '0';
      });
      
      // Muestra el contenido actual con animación
      setTimeout(() => {
        if (contents[currentIndex]) {
          contents[currentIndex].classList.add('active');
          animateItems(contents[currentIndex]);
        }
      }, 300); // Reducido para que la transición sea más rápida
    }
    
    function animateItems(content) {
      content.style.opacity = '1';
      const items = content.querySelectorAll('div');
      items.forEach((item, i) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(20px)';
        setTimeout(() => {
          item.style.transition = 'opacity 0.5s, transform 0.5s';
          item.style.opacity = '1';
          item.style.transform = 'translateY(0)';
        }, i * 40); // Reducido de 50ms a 40ms para que la animación sea aún más rápida
      });
    }
    
    function nextSlide() {
      currentIndex = (currentIndex + 1) % totalSlides;
      updateCarousel();
    }
    
    function prevSlide() {
      currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
      updateCarousel();
    }
    
    prevBtn.addEventListener('click', prevSlide);
    nextBtn.addEventListener('click', nextSlide);
    
    // Detectar swipe en dispositivos móviles
    let touchStartX = 0;
    let touchEndX = 0;
    
    carousel.addEventListener('touchstart', e => {
      touchStartX = e.changedTouches[0].screenX;
    });
    
    carousel.addEventListener('touchend', e => {
      touchEndX = e.changedTouches[0].screenX;
      handleSwipe();
    });
    
    function handleSwipe() {
      const minSwipeDistance = 50;
      if (touchEndX < touchStartX - minSwipeDistance) {
        // Swipe izquierda, ir al siguiente
        nextSlide();
      }
      
      if (touchEndX > touchStartX + minSwipeDistance) {
        // Swipe derecha, ir al anterior
        prevSlide();
      }
    }
    
    // Configurar clic en indicadores
    const dotBtns = document.querySelectorAll('.dot-btn');
    dotBtns.forEach((btn, index) => {
      btn.addEventListener('click', () => {
        currentIndex = index;
        updateCarousel();
      });
    });
    
    // Iniciar automáticamente con el primer slide
    updateCarousel();
  }
  
  // Asegurarse de que el carrusel se inicializa después de cargarse la página
  // y también después de navegaciones con client-side routing en Astro
  document.addEventListener('DOMContentLoaded', inicializarCarrusel);
  document.addEventListener('astro:page-load', inicializarCarrusel);
</script>